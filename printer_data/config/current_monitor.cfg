[gcode_shell_command LOG_START]
command: bash -c 'echo /home/scott/ina226_log_${1:-print}.csv > /tmp/ina226_current_logfile && touch /tmp/ina226_logging_on'
timeout: 2.0

[gcode_shell_command LOG_STOP]
command: bash -c 'if [ -f /tmp/ina226_current_logfile ]; then LOGFILE=$(cat /tmp/ina226_current_logfile); [ -n "$LOGFILE" ] && [ -f "$LOGFILE" ] && python3 /home/scott/ina226_plot.py "$LOGFILE"; fi; rm -f /tmp/ina226_logging_on /tmp/ina226_current_logfile'
timeout: 10.0
verbose: True

[gcode_macro LOGGING_START]
gcode:
    {% set filename = printer.print_stats.filename|default("print") %}
    RUN_SHELL_COMMAND CMD=LOG_START PARAMS={filename|replace('.gcode','')}

[gcode_macro LOGGING_STOP]
gcode:
    RUN_SHELL_COMMAND CMD=LOG_STOP
